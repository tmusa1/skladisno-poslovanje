DROP TABLE IF EXISTS public.bank_transaction_type CASCADE;

CREATE TABLE IF NOT EXISTS public.bank_transaction_type
(
    id integer NOT NULL,
    description character varying(50) COLLATE pg_catalog."default" NOT NULL,
    operator integer NOT NULL DEFAULT 0,
    CONSTRAINT bank_transaction_type_pkey PRIMARY KEY (id)
);


DROP TABLE IF EXISTS public.bank_account_type CASCADE;

CREATE TABLE IF NOT EXISTS public.bank_account_type
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    account_type_name character varying(200) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "PK_bank_account_type" PRIMARY KEY (id)
);

DROP TABLE IF EXISTS public.person CASCADE;

CREATE TABLE IF NOT EXISTS public.person
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    first_name character varying(100) COLLATE pg_catalog."default" NOT NULL,
	last_name character varying(100) COLLATE pg_catalog."default" NOT NULL,
	person_oib character varying(11) COLLATE pg_catalog."default" NOT NULL,
	address character varying(200) COLLATE pg_catalog."default" NULL,
    CONSTRAINT "PK_person" PRIMARY KEY (id)
);


DROP TABLE IF EXISTS public.bank_account CASCADE;

CREATE TABLE IF NOT EXISTS public.bank_account
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    account_no character varying(10) COLLATE pg_catalog."default" NOT NULL,
    account_type_id integer DEFAULT 0,
    person_id integer DEFAULT 0,
    CONSTRAINT "pk_bank_account" PRIMARY KEY (id),
    CONSTRAINT fk_account_type
      FOREIGN KEY(account_type_id) 
	  REFERENCES bank_account_type(id),
    CONSTRAINT fk_person
      FOREIGN KEY(person_id) 
	  REFERENCES person(id)    
);

DROP TABLE IF EXISTS public.bank_transaction CASCADE;

CREATE TABLE IF NOT EXISTS public.bank_transaction
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
 	transaction_date TIMESTAMP default NULL,
    bank_account_id integer DEFAULT 0,
    person_id integer DEFAULT 0,
    transaction_type_id integer DEFAULT 0,
	description character varying(100) COLLATE pg_catalog."default",
	amount NUMERIC(2),
    CONSTRAINT "pk_bank_transaction" PRIMARY KEY (id),
    CONSTRAINT fk_bank_account_transaction
      FOREIGN KEY(bank_account_id) 
	  REFERENCES bank_account(id),
    CONSTRAINT fk_person_transaction
      FOREIGN KEY(person_id) 
	  REFERENCES person(id),
    CONSTRAINT fk_transaction_type
      FOREIGN KEY(transaction_type_id) 
	  REFERENCES bank_transaction_type(id)
);

INSERT INTO public.bank_transaction_type VALUES (1,'Uplatnica',1);
INSERT INTO public.bank_transaction_type VALUES (2,'Isplatnica',-1);

INSERT INTO public.bank_account_type VALUES (1,'Tekući račun');
INSERT INTO public.bank_account_type VALUES (2,'Žiro račun');
INSERT INTO public.bank_account_type VALUES (3,'Devizni račun');

INSERT INTO public.person VALUES (1, 'Janko','Janković', '12345678901','Vodovodna 1222, Zagreb');
INSERT INTO public.person VALUES (2, 'Marko','Marković', '12345678902','Nova Cesta 1234, Zagreb');
INSERT INTO public.person VALUES (3, 'Slavko','Mirković', '12345678903','Pokupska 342, Karlovac');

INSERT INTO public.bank_account VALUES(1, '1111111111', 1, 1);
INSERT INTO public.bank_account VALUES(2, '2222222222', 1, 2);
INSERT INTO public.bank_account VALUES(3, '3333333333', 3, 3);
INSERT INTO public.bank_account VALUES(4, '4444444444', 3, 2);

ALTER TABLE IF EXISTS public.bank_transaction OWNER to postgres;
ALTER TABLE IF EXISTS public.bank_account OWNER to postgres;
ALTER TABLE IF EXISTS public.bank_account_type OWNER to postgres;
ALTER TABLE IF EXISTS public.person OWNER to postgres;
ALTER TABLE IF EXISTS public.bank_transaction_type OWNER to postgres;